<html>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script type="text/javascript" language ="javascript">
            function fields(){
                if(document.register.Operation.value != "Nonselezionata"){
                  document.register.param1.style = "visibility: visible"
                }
                return true;
            }

            function verify(){
              var dest = document.register.destination.value;
              if (typeof dest == "string"){
                return ture;
              }
              else{
                window.alert("Invalid destination")
              }
            }
        </script>

        <style>
        #btnadd {
             margin-top: 240px;
             margin-left: -27px;
             position: absolute;
         }
        </style>
    </head>

    <body style="overflow-y:hidden; overflow-x:hidden;">
        <form action="" method ="post" name ="register">
            <div align = center>
                <font color ="#000000">
                <b>Memory </b>
                <input type ="checkbox" name ="Memory" size ='3' value = 'yes'><br><br>

                <b>Preserved registers</b><br>
                EAX <input type ="checkbox" name ="eax" size ='3' value = 'yes'>
                EBX <input type ="checkbox" name ="ebx" size ='3' value = 'yes'>
                ECX <input type ="checkbox" name ="ecx" size ='3' value = 'yes'>
                EDX <input type ="checkbox" name ="edx" size ='3' value = 'yes'><br>
                ESP <input type ="checkbox" name ="esp" size ='3' value = 'yes'>
                EBP <input type ="checkbox" name ="ebp" size ='3' value = 'yes'>
                ESI <input type ="checkbox" name ="esi" size ='3' value = 'yes'>
                EDI <input type ="checkbox" name ="edi" size ='3' value = 'yes'><br>

                <br><b>Destination</b>
                <input type="text" name="destination" size = "5" onchange="return verify();"><br>

                <br><b>Stack Fix</b>
                <select name ="Stack_fix">
                    <option selected value="Nonselezionata">Non selezionata
                    <option value="4">4
                    <option value="8">8
                    <option value="12"> 12
                    <option value="16"> 16
                </select><br>

                <br><b>Operation</b>
                <select name ="Operation" onchange="return fields();">
                    <option selected value="Nonselezionata">Non selezionata
                    <option value="LoadConst">LoadConst
                    <option value="CopyReg">CopyReg
                    <option value="ReadMemOp"> ReadMemOp
                    <option value="IncReg"> IncReg
                    <option value="WriteMemOp"> WriteMemOp
                    <option value="SetZero"> SetZero
                    <option value="BinOp"> BinOp
                    <option value="ReadMem"> ReadMem
                    <option value="WriteMem"> WriteMem
                </select><br><br>

                <input type="text" name="param1" placeholder="insert parameter" style="visibility: hidden"><br>
                <input type="text" name="param2" placeholder="insert parameter" style="visibility: hidden"><br>
                <input type="text" name="param3" placeholder="insert parameter" style="visibility: hidden"><br>
                <input type="text" name="param4" placeholder="insert parameter" style="visibility: hidden"><br>
                <input type="text" name="param5" placeholder="insert parameter" style="visibility: hidden"><br>

                <br>
                <input type ="reset" value ="Reset"><br>
                <button type="button" name = "btnadd" id = "btnadd" style="visibility: hidden" onclick = "return chain();"> Add </button>

                </font>
            </div>
        </form>

        <script>
            var svgContainer = d3.select("body").append("svg")
              .attr("width", 20000)
              .attr("height", 20000);

            var block;
            function add_window(x){
              block = x;
              document.register.btnadd.style = "visibility: visible";
              var rectangle = svgContainer.append("rect")
              .attr("x", 40)
              .attr("y", 60)
              .attr("rx", 4)
              .attr("ry", 4)
              .attr("width", 250)
              .attr("height", 200)
              .attr("fill", "#e6f3ff")
              .style("stroke","black");

              svgContainer.append("text")
                  .attr("x",60)
                  .attr("y", 85)
                  .attr("dy", 0)
                  .text(x.data.type)
                  .call(wrap, 210);
            }


            function wrap(text, width) {
              text.each(function() {
                var text = d3.select(this),
                    words = text.text().split(/\s+/).reverse(),
                    word,
                    line = [],
                    lineNumber = 0,
                    lineHeight = 1.1, // ems
                    y = text.attr("y"),
                    dy = parseFloat(text.attr("dy")),
                    tspan = text.text(null).append("tspan").attr("x", 60).attr("y", y).attr("dy", dy + "em")
                while (word = words.pop()) {
                  line.push(word)
                  tspan.text(line.join(" "))
                  if (tspan.node().getComputedTextLength() > width) {
                    line.pop()
                    tspan.text(line.join(" "))
                    line = [word]
                    window.alert(lineNumber);
                    tspan = text.append("tspan").attr("x", 60).attr("y", y).attr("dy", `${++lineNumber * lineHeight + dy}em`).text(word)
                  }
                }
              })
             }

             function chain(){
               parent.down.add_block(block.data.type);
             }
        </script>
    </body>
</html>
